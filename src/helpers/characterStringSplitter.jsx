/*40499:3817:41398:42702:0:0:0:0:80:0:0:0:0:0:0:0:0:.44664:0:40003:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40502:3808:40003:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.2105:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40495:3832:40003:40053:0:0:0:0:80:0:0:0:0:0:0:0:0:.40205:0:40003:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.44011:3823:40003:39910:0:0:0:0:80:0:0:0:0:0:0:0:0:.34575:3606:40003:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.34448:3845:40003:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40496:3604:40053:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40586:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.37642:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.44253:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40684:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40721:3730:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.39714:3789:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40386:3789:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.39296:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.43156:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.!6:1_083022.7:1_083022.8:1_083022.9:1_083022.a:1_083022.b:1_083022.c:1_083022.d:1_092922.1f:1_091322.21:6 / 130.23:1.24:1_092822.26:1_092922.27:1_092822.2a:1_090322.2b:1_090322.2c:1_090322.2d:1_102222.2e:1_102222.31:7.32:9.33:5.34:22.35:33.36:53.37:23.38:12.39:42.3b:38.3c:971.5e:181.5f:13.67.61:389.62:2132.63:100.64:50.65:103.66:9.67:94.68:35.69:1.6b:72035.6c:2244.6e:7 (Sjonnir the Ironshaper).71:1.72:15.74:1_083022.79:1_083022.7a:1_083022.7b:1_083022.7c:1_083022.7d:1_092722.7e:1_091322.7f:1_091622.80:1_091622.81:1_091722.83:1_083022.84:1_083022.85:1_083022.86:1_083022.87:1_092822.90:1_091822.99:1_091822.9a:1_083122.a6:1_083122.b7:113.bd:51205.c1:165346.c5:418739463.c6:5172716.c7:1_083022.d0:1_083122.d4:1_083022.da:1_083022.df:1_091622.e3:1_092322.e5:1_083122.e9:1_083122.ee:1_083022.f5:1_090222.ff:1_101822.119:424.120:1_101922.121:1_101922.127:1_092122.12f:1_092522.13e:761.13f:10.140:4.141:152.142:13.143:7.144:14.146: 11030 62 19.148: 30615 9 16.149:1511.14a:1569.14b: 497 99 98.14c: 470 43 74.14d: 4871 20 6.14e: 12881 28 58.150:5.152:9.153:34.155:51.156:234.158:268.159:87.15a:327.15b:615.15d:365.15e:73.161:128.16a:13.16b:27.16c:63.16d:118.16e:74.16f:165.172:1579.179:8.17a:20.17d:4.17e:1350.17f:95.189:11.18a:3.18b:2.18d:1_101122.1ae:1_083022.1c8:1.1c9:1.1ca:1.1dd:1_100122.1de:1_100122.1df:1_100322.1e0:1_100322.1e1:1_100122.1e2:1_093022.1e3:1_100322.1e4:1_092822.1e5:1_100122.1e6:1_100122.1e7:1_100122.1e8:1_100122.1e9:1_100122.1ea:1_100122.1eb:1_100322.1ec:1_100122.1ed:1_093022.1ee:1_100322.1ef:1_093022.1f0:1_100122.1f1:1_100122.1f2:1_100122.1f3:1_100122.1f7:1_083022.1f8:1_083022.1f9:1_083022.1fa:1_083022.1fb:1_092622.1fc:1_092822.201:1_083022.203:1_083022.204:1_083022.20a:1_083022.20b:1_092322.20f:23807.210:34414695.211:28.221:1_083122.222:1_083022.223:1_092722.22d:1_100522.22e:1_100122.232:1_100822.233:1_101022.234:1_100822.235:1_101022.236:1_100822.237:1_101022.238:1_100822.239:1_101022.23c:1_100822.23d:1_101022.23e:1_100822.23f:1_101022.240:1_100822.241:1_101022.249:17.24a:17.24c:4426.253:1557.254:1322.26b:1_090422.26d:1_083022.26e:1_100822.26f:1_101022.271:1_101022.273:1_090322.274:1_090322.275:1_083022.276:1_091122.27b:1_091122.27c:1_091122.287:1_083022.288:1_083022.289:1_091822.28c:1_083022.28d:1_083022.28f:1_091922.290:1_083022.293:1_083022.295:1_083022.29d:1_091822.2a2:1_083022.2aa:1_083022.2b2:1_083022.2b3:1_083022.2b4:1_090722.2b5:1_091422.2b8:1_090722.2b9:1_083022.2ba:1_083122.2bb:1_101522.2bc:1_083022.2c1:1.2d6:1_091822.2d7:1_100322.2d8:1_090322.2d9:1_091022.2db:1_083022.2dc:1_083022.2dd:1_083022.2de:1_092722.2df:2_092722.2e0:1_090322.2ee:1_090322.2f0:22.2f1: 147 89 89.2f7:2.49.2f8:1_090322.2f9:1_090322.2fd:1_090322.2fe:1_090322.300:1_090222.301:1_090322.302:1_090222.303:1_090222.304:1_090322.305:1_090322.306:1_090322.307:1_090322.308:1_090322.309:1_083022.30a:1_090322.30b:1_090322.30c:1_090322.30d:1_090322.30e:1_090322.31c:11.31e:7.31f:9.320:28.321:1.322:1_090322.32b:30.32c:82.33d:16622.33e:27650717.345:103.346:310.347:134.348:24.349:1_090322.34a:1_090322.34b:1_090322.34c:1_090322.34d:1_090322.34e:1_083022.34f:1_090322.350:1_090322.351:1_090322.352:1_090322.353:1_090322.354:1_090322.355:1_090322.356:1_090322.357:1_090322.358:1_090322.359:1_090322.35a:1_090222.35b:1_090322.35c:1_090322.35d:1_090322.35e:1_083022.35f:1_090322.360:1_083022.361:1_090322.362:1_090322.363:1_083022.364:1_083022.36d:1_092222.379:1_083022.37a:1_083022.37b:1_083022.37c:1_083022.381:1_092322.385:1_091322.387:1_083022.38a:1_091722.394:56.395:49.396:5.397: 14713 26 91.39b:144.39c:9.39d:11.39e:14.39f:18.3a0:7.3a3:52.3a4:212.3a5:54.3a6:28.3aa:1_092822.3ab:1_083022.3b1:1_100322.3b2:1_083022.3b3:1_100322.3c4:1_090322.3c5:1_101922.3c7:1_101922.3c8:1_101922.3cb:1_101922.3cc:1_101822.3cd:1_083022.3ce:1_083022.3cf:1_092022.3d3:1_101922.3d5:1_101922.3ed:1_083122.3f1:1_100522.3f9:1_090322.3fc:5 / 10.3fd:5 / 25.403:1_083022.409:1_083022.411:1_101922.412:1.413:585.414:151.415:7.421:74.429:11.42a:2.42c:1.42e:2.42f:1.432:1.434:1.435:1.438:2.43a:11.43b:5.43c:2.43d:2.43e:1.440:1.441:5.442:4.443:1.449:6.44f:49.450:12.452:88.453:56.454:4.455:67.456:182.457:158.458:576.459:335.45a:249.45b:115.465:152 (Heavy Netherweave Bandage).47a: 83 47 96.47b: 29 52 96.47c: 3 16 50.485:1_083022.498: 1_083022.499: 1_083022.49a: 0.49c: 0.49d: 0.49e: 1_101922.4a2:1_092022.4a5:1.4a7:1.4ad:78708.4ae:53353.4af:2.4b0:3.4b1:2.4b2:9.4b3:1_092022.4c9:1_091822.4cd:13.4d4:1.4db:1_091822.4e5:4.4ea:1_083122.4ef:1_102222.4f0:1_100622.4f1:1_092822.4f2:1_092822.4f3:1_092822.4f4:1_102222.4f5:1_092922.4f6:1_100722.4f7:1_083022.4f8:1_083022.508:1_100322.509:1_100322.512:8.513:45 (Runic Healing Injector).514:9.517:70 (Elixir of Major Agility).518:10.519:26 (Flask of Endless Rage).51a:2.51c:1_102522.51e:1_102522.51f:1_091522.538:24343 (Undead).539:10.53b:32 (Portal to Shattrath).54c:1_092722.54d:1_092822.54e:6 / 150.54f:1_092722.551:4.552:4.553:4.554:4.555:4.556:4.557:4.558:4.559:4.55a:4.55b:4.55c:4.55d:4.55e:4.55f:40.560:4.561:4.562:4.563:4.564:4.565:4.566:4.567:100.568:4.569:4.56a:4.56b:4.56c:4.56d:4.56e:4.56f:4.570:4.571:4.572:4.578:1.57a:1.585:1.58a:1.5b0:2593.5b1:1_102222.5b2:2 (Northrend).5b6:412.5b8:254.5b9:208.5ba:1.5bb:183.5cd:46.5ce:75.5cf:18917.5d0:12794.5d1:4242 (Burning Crusade Areas).5d2:53.5d3:944.5d4:92.5d5:73.5d6:20.5d7:142.5d8:209.5d9:120.5da:449.5db:24.5dc:13.5dd:779.5e0:5.5e1:4.5e2:5.5e3:4.5e4:6.5e5:2.5e6:3.5e7:7.5e8:6.5e9:4.5ea:5.5eb:1.5ee:2593.5ef:346.5f0:%.5f4:447.5f5:27.5f6:9.606:430.608:450.60b:13.60c:9.60d:3.60e:2.60f:%.614:1_091322.615:1_091322.616:1_091622.617:1_091622.618:1_091622.619:1_091622.628:1_092822.679:1_102022.67a:1_100922.68c:115 / 700.68d:115 / 550.68e:356 / 700.690:356 / 685.693:1_092522.694:1.6b4:449 (Eye of the Storm).6b5:1_093022.6b7:576 (Eye of the Storm).6b9:1_101022.6ba:1_100822.6bb:100 / 100_100622.6bf:1_093022.6c6:174.6cd:139.6d1:142.6d4:29.6d9:4.6da:4.6db:1_093022.6dc:168.6df:18.6e0:100 (The Four Horsemen).6e8:12.6ea:108.6eb:18.6ec:40 (The Four Horsemen).6ed:161 (Thistle Tea).6ee:19.6ef:45.6f0:114 (Salted Venison).6f1:8.6f2:8.6f3:8.6f4:1_100322.6f7:1_101422.703:1_090322.704:1_092722.718:1_100322.728:45 / 50.729:19 / 25.72a:1_100122.72c:1_091622.72d:1_091722.740:1_101122.741:1_101022.742:1_100822.743:1_101022.744:1_100322.745:%.746:1_100522.74a:1_100122.74b:1_100122.74c:1_100422.751:1_100122.753:1_101922.754:1_100922.790:1_092022.7b8:27.7cc:1_100822.7ce:1_100322.7cf:1_101322.7d0:1_102522.7fa:1_100122.801:1_100922.802:1_100922.804:1_101022.805:1_101022.806:1_101222.80a:1_093022.824:1_100122.825:1_102522.85b:1_101022.85c:1_101022.85d:1_091022.85e:1_091322.864:1_100822.865:1_101922.86a:1_100122.86c:1_100122.86d:1_100122.88b:1_102022.8a8:2 (Trollgore).8a9:3 (Sartharion).8aa:4 (Sartharion).8ab:35.8e5:71.95c:53 (Eye of the Storm).95d:9 (Eye of the Storm).9ac:1_100322.a24:2.aec:1_092522.d1d:2_101022.da8:1_092522.efe:1_101322.eff:25 / 25_101322.f00:50 / 50_101322.f01:100 / 100_101322.f02:250 / 250_101322.f03:462 / 500.f04:462 / 1000.f24:462 / 1500.10dc:462 / 2500. 

*/

import classIDtoName from "./classIDtoName";
import formatCharStats from "./formatCharStats";
import getFactionFromRace from "./getFactionFromRace";


export default function characterStringSplitter(characterString, setCharacter, setCharacterExists, allStats) {
  let [itemString, miscString, statisticString] = characterString.split("!");
  let miscArray = miscString.split(".");
  setCharacterExists(true);
  let charStats = statisticStringSplitter(statisticString);
  allStats = formatCharStats(charStats, allStats);

  if (miscArray[3] === "null") {
    miscArray[3] = null;
  }

  let miscInfo = {
    name: miscArray[0],
    server: miscArray[1],
    region: miscArray[2],
    title: miscArray[3],
    wowRace: miscArray[6],
    level: Number(miscArray[7]),
    wowClassID: Number(miscArray[4]),
    wowClass: classIDtoName(miscArray[4]),
    faction: getFactionFromRace(miscArray[6]),
    achPoints: Number(miscArray[5]),
  }
  let characterData =  {
    name: miscInfo.name[0].toUpperCase() + miscInfo.name.substring(1).toLowerCase(),
    characterString: characterString,
    itemString: itemString,
    miscInfo: miscInfo,
    statisticString: statisticString,
    statistics: {...charStats, ...allStats}
  }

  setCharacter((prev) => (
    {...prev, characterData}
  ))

}

const hexToDecimal = hex => parseInt(hex, 16);

function statisticStringSplitter(statisticString) {
  let statisticsArr = statisticString.split(".");
  let statistics = {}


  for (const stat of statisticsArr) {
    let [statisticID, statisticValues] = stat.split(":");
    if (statisticID !== "") {
      if (statisticValues && statisticValues.includes("_")) {
        let [statisticValue, dateCompleted] = statisticValues.split("_");
        if (statisticValue) {
          statisticValue = statisticValue.trim();
        }
        statistics[hexToDecimal(statisticID)] = { stat_id: hexToDecimal(statisticID), value: statisticValue, dateCompleted: dateCompleted }
      } else {
        let statisticValue = statisticValues;
        if (statisticValue) {
          statisticValue = statisticValue.trim();
        }
        statistics[hexToDecimal(statisticID)] = { stat_id: hexToDecimal(statisticID), value: statisticValue, dateCompleted: null };
      }
    }
    // statisticsObj[hexToDecimal(statisticID)] = {value: null, dataCompleted: null};

  }

  return statistics;

}
import React from 'react'
import { useParams } from 'react-router-dom'
import { useEffect, useState, useContext } from 'react'
import MoonLoader from 'react-spinners/MoonLoader'
import CharacterHeader from './CharacterHeader'
import Tooltip from './Tooltip'
import ItemSections from './ItemSections'
import getAccessToken from '../helpers/blizzardAPI/getAccessToken'
import getWCLAccessToken from '../helpers/WCLAPI/getWCLAccessToken'
import { AccessTokenContext } from '../helpers/Context'
import { WCLTokenContext } from '../helpers/WCLContext'
import characterStringSplitter from '../helpers/characterStringSplitter'
import itemStringToObject from '../helpers/itemStringToObject'
import Achievements from './Achievements/Achievements'
import SpecializationSection from './SpecializationSection'
import Raids from './PvE/Raids'
import PvP from './PvP/PvP'

export default function Character(props) {
  const { accessToken, setAccessToken } = useContext(AccessTokenContext)
  const { WCLToken, setWCLToken } = useContext(WCLTokenContext)
  // let backendURL = "http://localhost:3000";
  const [show, setShow] = useState(false)
  const [item, setItem] = useState({})
  const [loading, setLoading] = useState(true)
  const [characterExists, setCharacterExists] = useState(false)
  const [navItem, setNavItem] = useState({
    selected: 'Character',
    charHighlight: 'IsSelected',
    achHighlight: '',
  })
  const [specSelected, setSpecSelected] = useState({
    selected: 'Primary',
    talentString: '',
    primaryHighlight: 'IsSelected',
    secondaryHighlight: '',
  })

  const demoCharacter =
    '48240:3817:41398:49110:0:0:0:0:80:0:0:0:0:0:0:0:0:.45517:0:39999:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.48238:3808:40114:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.2105:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.48242:3832:40114:40114:0:0:0:0:80:0:0:0:0:0:0:0:0:.47299:0:40157:40114:0:0:0:0:80:0:0:0:0:0:0:0:0:.48239:3823:40114:40114:0:0:0:0:80:0:0:0:0:0:0:0:0:.47992:3606:40157:40157:0:0:0:0:80:0:0:0:0:0:0:0:0:.45108:3845:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.48241:3604:40114:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.45525:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.40474:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.48020:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.44253:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.45224:3730:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.47255:3789:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.47300:3789:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.48697:3607:40157:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.43156:0:0:0:0:0:0:0:80:0:0:0:0:0:0:0:0:.!Armoryexample.Faerlina.US.the Immortal.4.6425.Troll.80!025003100000000000000000000-3000000000000000000000000000-2120232030322121350135231251.1:715.2:464.3:468.4:399.5:467.6:731!005303005352100520103331051-0050050030000000000000000000-5020000000000000000000000000.1:400.2:468.3:467.4:733.5:464.6:714!2!0.0.0:0.0.0:0.0.0!6:1_20220830.7:1_20220830.8:1_20220830.9:1_20220830.a:1_20220830.b:1_20220830.c:1_20220830.d:1_20220929.f:1_20230507.10:1_20230301.1f:1_20220913.21:6 / 130.23:1.24:1_20220928.26:1_20220929.27:1_20220928.2a:1_20220903.2b:1_20220903.2c:1_20220903.2d:1_20221022.2e:1_20221022.31:10.32:14.33:6.34:26.35:37.36:63.37:26.38:38.39:45.3b:54.3c:1590.49:1_20220831.5e:209.5f:3.18.61:488.62:2189.63:127.64:64.65:137.66:23.67:133.68:54.69:2.6b:110412.6c:3263.6e:10 (Sjonnir the Ironshaper).71:1.72:17.74:1_20220830.79:1_20220830.7a:1_20220830.7b:1_20220830.7c:1_20220830.7d:1_20220927.7e:1_20220913.7f:1_20220916.80:1_20220916.81:1_20220917.82:1_20230123.83:1_20220830.84:1_20220830.85:1_20220830.86:1_20220830.87:1_20220928.8d:1_20221011.90:1_20220918.96:1_20220917.99:1_20220918.9a:1_20220831.9f:1_20220908.a6:1_20220831.a8:1_20220831.b7:113.bd:58648.c1:448774.c5:2172296644.c6:8750468.c7:1_20220830.d0:1_20220831.d4:1_20220830.d6:1_20220925.d8:1_20220916.da:1_20220830.df:1_20220916.e2:1_20230802.e3:1_20220923.e5:1_20220831.e9:1_20220831.ee:1_20220830.f5:1_20220902.f7:1_20220923.f9:1_20230410.fc:1_20221228.ff:1_20221018.103:1_20221219.104:1_20230212.107:1_20230625.10f:1_20230625.110:1_20230625.111:1_20221219.115:1_20221222.117:1_20221219.119:450.11b:1_20221020.120:1_20221019.121:1_20221019.123:1_20221019.124:1_20221020.127:1_20220921.12f:1_20220925.13e:991.13f:12.140:4.141:537.142:25.143:38.144:91.146: 15203 14 99.148: 61842 63 46.149:2583.14a:2266.14b: 1439 88 98.14c: 668 8 67.14d: 10067 78 40.14e: 19934 57 30.150:5.152:16.153:83.155:116.156:334.158:339.159:111.15a:514.15b:802.15d:439.15e:96.161:128.16a:42.16b:99.16c:70.16d:134.16e:104.16f:214.172:1579.179:10.17a:21.17d:4.17e:2108.17f:312.189:12.18a:4.18b:2.18d:1_20221011.18e:1_20230802.18f:1_20220929.199:ivor at the end of a ranked 5v5 match at level 80..1ae:1_20220830.1c8:1.1c9:1.1ca:1.1dd:1_20221001.1de:1_20221001.1df:1_20221003.1e0:1_20221003.1e1:1_20221001.1e2:1_20220930.1e3:1_20221003.1e4:1_20220928.1e5:1_20221001.1e6:1_20221001.1e7:1_20221001.1e8:1_20221001.1e9:1_20221001.1ea:1_20221001.1eb:1_20221003.1ec:1_20221001.1ed:1_20220930.1ee:1_20221003.1ef:1_20220930.1f0:1_20221001.1f1:1_20221001.1f2:1_20221001.1f3:1_20221001.1f4:1_20221003.1f7:1_20220830.1f8:1_20220830.1f9:1_20220830.1fa:1_20220830.1fb:1_20220926.1fc:1_20220928.200:1_20230517.201:1_20220830.203:1_20220830.204:1_20220830.20a:1_20220830.20b:1_20220923.20c:1_20231011.20f:30491.210:108105230.211:30.221:1_20220831.222:1_20220830.223:1_20220927.22c:1_20221124.22d:1_20221005.22e:1_20221001.22f:1_20221026.232:1_20221008.233:1_20221010.234:1_20221008.235:1_20221010.236:1_20221008.237:1_20221010.238:1_20221008.239:1_20221010.23c:1_20221008.23d:1_20221010.23e:1_20221008.23f:1_20221010.240:1_20221008.241:1_20221010.246:1_20220915.247:1_20220905.249:21.24a:18.24c:5797.253:1557.254:1541.25d:1_20230123.25e:1_20230207.25f:1_20230207.260:1_20230207.261:1_20230210.267:1_20220904.268:1_20220904.269:1_20220904.26a:1_20220904.26b:1_20220904.26d:1_20220830.26e:1_20221008.26f:1_20221010.271:1_20221010.272:1_20230210.273:1_20220903.274:1_20220903.275:1_20220830.276:1_20220911.278:1_20220912.27b:1_20220911.27c:1_20220911.284:1_20220912.287:1_20220830.288:1_20220830.289:1_20220918.28c:1_20220830.28d:1_20220830.28f:1_20220919.290:1_20220830.293:1_20220830.295:1_20220830.29d:1_20220918.2a2:1_20220830.2aa:1_20220830.2b2:1_20220830.2b3:1_20220830.2b4:1_20220907.2b5:1_20220914.2b8:1_20220907.2b9:1_20220830.2ba:1_20220831.2bb:1_20221015.2bc:1_20220830.2c1:3.2d6:1_20220918.2d7:1_20221003.2d8:1_20220903.2d9:1_20220910.2da:1_20230123.2db:1_20220830.2dc:1_20220830.2dd:1_20220830.2de:1_20220927.2df:1_20220927.2e0:1_20220903.2ee:1_20220903.2f0:50.2f1: 83 68 42.2f7:0.71.2f8:1_20220903.2f9:1_20220903.2fd:1_20220903.2fe:1_20220903.300:1_20220902.301:1_20220903.302:1_20220902.303:1_20220902.304:1_20220903.305:1_20220903.306:1_20220903.307:1_20220903.308:1_20220903.309:1_20220830.30a:1_20220903.30b:1_20220903.30c:1_20220903.30d:1_20220903.30e:1_20220903.31c:37.31e:21.31f:22.320:76.321:2.322:1_20220903.32b:155.32c:316.33d:20697.33e:92388425.345:169.346:447.347:162.348:36.349:1_20220903.34a:1_20220903.34b:1_20220903.34c:1_20220903.34d:1_20220903.34e:1_20220830.34f:1_20220903.350:1_20220903.351:1_20220903.352:1_20220903.353:1_20220903.354:1_20220903.355:1_20220903.356:1_20220903.357:1_20220903.358:1_20220903.359:1_20220903.35a:1_20220902.35b:1_20220903.35c:1_20220903.35d:1_20220903.35e:1_20220830.35f:1_20220903.360:1_20220830.361:1_20220903.362:1_20220903.363:1_20220830.364:1_20220830.36d:1_20220922.375:1_20231010.379:1_20220830.37a:1_20220830.37b:1_20220830.37c:1_20220830.381:1_20220923.385:1_20220913.387:1_20220830.38a:1_20220917.38d:1_20220831.38e:1_20230210.38f:1_20230210.390:1_20230210.391:1_20230210.392:1_20230210.393:1_20230210.394:314.395:140.396:12.397: 36571 70 7.39b:144.39c:9.39d:12.39e:14.39f:18.3a0:7.3a3:54.3a4:281.3a5:71.3a6:80.3a9:1_20230210.3aa:1_20220928.3ab:1_20220830.3b1:1_20221003.3b2:1_20220830.3b3:1_20221003.3c4:1_20220903.3c5:1_20221019.3c7:1_20221019.3c8:1_20221019.3cb:1_20221019.3cc:1_20221018.3cd:1_20220830.3ce:1_20220830.3cf:1_20220920.3d3:1_20221019.3d4:1_20231018.3d5:1_20221019.3ed:1_20220831.3ef:1_20231011.3f1:1_20221005.3f9:1_20220903.3fc:5 / 10.3fd:5 / 25.401:1_20230625.402:1_20230625.403:1_20220830.407:1_20230625.408:1_20230625.409:1_20220830.40c:1_20230625.40d:1_20230625.40f:1_20230625.411:1_20221019.412:1.413:878.414:248.415:7.421:93.429:14.42a:5.42c:1.42e:2.42f:1.432:2.434:1.435:1.438:2.43a:11.43b:5.43c:2.43d:2.43e:1.440:1.441:5.442:4.443:1.449:6.44a:1.44f:71.450:27.452:145.453:65.454:45.455:214.456:201.457:209.458:953.459:346.45a:339.45b:213.465:152 (Heavy Netherweave Bandage).479:1_20230625.47a: 107 99 17.47b: 62 88 15.47c: 4 51 80.485:1_20220830.48e:1_20220915.498:1_20220830.499:1_20220830.49a:1_20221102.49c:1_20231016.49d: 0.49e:1_20221019.49f:1_20230903.4a1:1_20220920.4a2:1_20220920.4a4:1_20230216.4a5:1.4a7:1.4ad:119475.4ae:58902.4af:2.4b0:3.4b1:2.4b2:9.4b3:1_20220920.4c9:1_20220918.4cd:24.4d4:1.4d8:1.4d9:5.4db:1_20220918.4e5:9.4e6:1_20221104.4ea:1_20220831.4ec:1_20220921.4ed:1_20221020.4ef:1_20221022.4f0:1_20221006.4f1:1_20220928.4f2:1_20220928.4f3:1_20220928.4f4:1_20221022.4f5:1_20220929.4f6:1_20221007.4f7:1_20220830.4f8:1_20220830.500:1_20230218.501:1_20230123.502:1_20221228.508:1_20221003.509:1_20221003.50b:1_20230216.512:8.513:67 (Runic Healing Injector).514:9.517:70 (Elixir of Major Agility).518:10.519:151 (Flask of Endless Rage).51a:2.51c:1_20221025.51e:1_20221025.51f:1_20220915.538:33257 (Undead).539:10.53b:37 (Portal to Dalaran).54c:1_20220927.54d:1_20220928.54e:6 / 150.54f:1_20220927.551:5.552:5.553:5.554:5.555:5.556:5.557:15.558:15.559:5.55a:5.55b:5.55c:5.55d:5.55e:5.55f:60.560:6.561:6.562:15.563:15.564:15.565:15.566:15.567:375.568:15.569:15.56a:15.56b:15.56c:15.56d:17.56e:17.56f:5.570:8.571:15.572:16.574:1_20230207.578:1.57a:1.584:1.588:1.58a:1.58b:1.5b0:3059.5b1:1_20221022.5b2:2 (Northrend).5b6:412.5b8:254.5b9:536.5ba:1.5bb:287.5cd:54.5ce:215.5cf:24167.5d0:13952.5d1:4291 (Burning Crusade Areas).5d2:136.5d3:1142.5d4:118.5d5:83.5d6:67.5d7:146.5d8:230.5d9:136.5da:569.5db:51.5dc:41.5dd:1033.5e0:8.5e1:4.5e2:5.5e3:5.5e4:15.5e5:3.5e6:5.5e7:10.5e8:7.5e9:5.5ea:6.5eb:1.5ee:3059.5ef:377.5f0:%.5f4:450.5f5:35.5f6:12.606:445.608:450.60b:50.60c:28.60d:8.60e:3.60f:%.610:1_20230123.614:1_20220913.615:1_20220913.616:1_20220916.617:1_20220916.618:1_20220916.619:1_20220916.628:1_20220928.679:1_20221020.67a:1_20221009.68c:115 / 700.68d:115 / 550.68e:356 / 700.690:356 / 685.693:1_20220925.694:1.695:1_20221222.697:1_20221228.698:1_20221219.699:1_20221226.69a:1_20221222.69b:1_20221228.69d:1_20230219.69e:1_20230216.69f:1_20230212.6a0:1_20230213.6a2:1_20230213.6a3:1_20230218.6a4:1_20230219.6a5:1_20230212.6a6:1_20230216.6a7:1_20230216.6a8:1_20230219.6b4:569 (Eye of the Storm).6b5:1_20220930.6b7:953 (Eye of the Storm).6b9:1_20221010.6ba:1_20221008.6bb:1_20221006.6bf:1_20220930.6c6:171.6cd:143.6d1:168.6d4:29.6d9:4.6da:11.6db:1_20220930.6dc:755.6df:35.6e0:375 (The Four Horsemen).6e6:1_20221026.6e8:65.6ea:205.6eb:33.6ec:60 (The Four Horsemen).6ed:206 (Conjured Mana Strudel).6ee:34.6ef:62.6f0:206 (Conjured Mana Strudel).6f1:9.6f2:9.6f3:9.6f4:1_20221003.6f7:1_20221014.6fc:1_20230507.6fd:1_20230507.6fe:1_20230507.6ff:1_20230507.700:1_20230507.701:1_20230507.703:1_20220903.704:1_20220927.705:1_20221126.718:1_20221003.719:1_20221003.728:1_20230212.729:1_20230301.72a:1_20221001.72c:1_20220916.72d:1_20220917.740:1_20221011.741:1_20221010.742:1_20221008.743:1_20221010.744:1_20221003.745:%.746:1_20221005.74a:1_20221001.74b:1_20221001.74c:1_20221004.751:1_20221001.753:1_20221019.754:1_20221009.790:1_20220920.7b8:38.7cc:1_20221008.7cd:1_20221025.7ce:1_20221003.7cf:1_20221013.7d0:1_20221025.7e1:1_20221003.7f9:1_20221003.7fa:1_20221001.7ff:1_20221110.800:1_20221102.801:1_20221009.802:1_20221009.803:1_20221130.804:1_20221010.805:1_20221010.806:1_20221012.808:1_20221005.809:1_20221005.80a:1_20220930.81c:1_20231123.820:1_20231026.822:1_20231019.823:1_20231019.824:1_20221001.825:1_20221025.826:1_20221028.827:1_20230315.828:1_20231024.82a:1_20220929.85a:1_20230104.85b:1_20221010.85c:1_20221010.85d:1_20220910.85e:1_20220913.85f:1_20231010.861:1_20230625.862:1_20221020.863:1_20221010.864:1_20221008.865:1_20221019.866:1_20221006.86a:1_20221001.86c:1_20221001.86d:1_20221001.880:1_20221130.881:1_20230104.882:1_20221020.883:1_20221228.889:1_20221019.88a:1_20221228.88b:1_20221020.88c:1_20220910.88e:1_20230517.891:1_20230802.8a8:3 (Skadi the Ruthless).8a9:14 (Sartharion).8aa:15 (Steelbreaker).8ab:62.8e5:137.95c:63 (Eye of the Storm).95d:14 (Eye of the Storm).970:1_20230411.971:1_20230410.972:1_20230410.974:1_20230411.976:1_20230411.984:1_20230411.9ac:1_20221003.9c1:1_20230411.a10:1_20230410.a24:2.a74:1_20230410.a9c:1_20220831.ac4:1_20230507.aec:1_20220925.aee:1_20230411.b28:3.b29:3.b2a:3.b2b:3.b2c:3.b2d:3.b2e:3.b2f:2.b30:2.b31:2.b32:2.b34:3.b35:2.b38:8.b39:8.b3a:8.b3b:7.b3f:8.b40:8.b41:1.b42:8.b43:8.b44:8.b45:8.b46:1_20230123.b47:1_20230123.b48:1_20230123.b49:1_20230123.b4a:1_20230204.b4b:1_20230123.b4c:1_20230204.b4d:1_20230124.b4e:1_20230204.b4f:1_20230124.b5f:1_20230123.b60:1_20230123.b61:1_20230203.b62:1_20230203.b63:1_20230203.b64:1_20230125.b65:1_20230208.b66:1_20230125.b67:1_20230123.b69:1_20230123.b70:1_20230123.b71:1_20230123.b72:1_20230203.b73:1_20230306.b74:1_20230123.b76:1_20230123.b78:1_20230123.b79:1_20230203.b7a:1_20230123.b7c:1_20230123.b7d:1_20230203.b7f:1_20230123.b80:1_20230503.b84:1_20230503.b8a:1_20230215.b91:1_20230204.b92:1_20230308.b93:1_20230123.b95:1_20230123.b9a:1_20230208.b9b:1_20230204.b9d:1_20230204.b9e:1_20230123.ba1:1_20230123.ba2:1_20230126.ba4:1_20230204.ba5:1_20230201.bc0:1_20230204.bc1:1_20230306.bc2:1_20230124.bc3:1_20230302.bc4:1_20230306.bc8:1_20230124.bca:258.bdd:1_20230329.bf0:1_20230203.bf1:1_20230208.bf2:1_20230306.bf3:1_20230222.c1a:1_20230208.c41:1_20230125.c45:1_20230204.c55:1_20230204.c56:1_20230204.c59:1_20230206.c5a:1_20230206.c5b:1_20230206.c68:1_20230204.c69:1_20230204.c6a:1_20230204.c6b:1_20230204.c6c:1_20230306.c6d:1_20230204.c6e:1_20230204.c6f:1_20230208.c70:1_20230301.c71:1_20230213.c72:1_20230213.c73:1_20230213.c74:1_20230202.c75:1_20230503.ca4:6.cb8:10.cb9:8.cba:8.cbb:1.d1d:1_20221010.d80:1_20221101.d81:1_20220919.da8:1_20220925.dbc:258.de5:1_20221128.de6:1_20221126.de7:1_20221128.df9:1_20221127.dfa:1_20221127.dfb:1_20221126.dfd:1_20221128.dfe:1_20221128.e0d:1_20221127.e48:1_20221128.ec0:1_20230801.ec2:1_20231021.ed7:1_20230730.eda:2.ee0:1_20230730.ee1:1_20230730.ee2:1_20230730.ee7:1_20230716.efc:1_20230802.efd:1_20230802.efe:1_20221013.eff:1_20221013.f00:1_20221013.f01:1_20221013.f02:1_20221013.f03:1_20221103.f04:1_20230306.f24:1_20231016.f4c:1_20230716.f4d:1_20230730.f4e:1_20230730.f9d:1_20230716.fb3:2.fb7:2.fbb:2.fbc:6.fbe:6.fbf:9.fc0:6.fc1:6.fc2:9.fc3:1.fc4:6.fc5:6.fc6:9.fc8:6.fc9:6.fca:9.fcc:6.fcd:6.fce:9.fd1:1.fd3:1.fd5:1.fea:1.feb:1.1000:2.1001:1.10c8:1.10c9:1_20231021.10ca:1.10dc:1558 / 2500.112d:1_20230802.1135:1_20230802.1137:1_20230802.12ae:1_20220924.12b0:1.12b1:1_20220927.'

  const { region, server, characterName } = useParams()
  const [charLoading, setCharLoading] = useState({
    1: false,
    2: false,
    3: false,
    4: false,
    5: false,
    6: false,
    7: false,
    8: false,
    9: false,
    10: false,
    11: false,
    12: false,
    13: false,
    14: false,
    15: false,
    16: false,
    17: false,
    18: false,
    19: false,
  })
  const setTooltip = function (show, item) {
    setShow(show)
    setItem(item)
  }

  const [character, setCharacter] = useState({
    inventory: {},
  })

  const [mouseX, setMouseX] = useState()
  const [mouseY, setMouseY] = useState()

  useEffect(() => {
    const update = (e) => {
      setMouseX(e.x)
      setMouseY(e.y)
    }
    window.addEventListener('mousemove', update)
    window.addEventListener('touchmove', update)
    return () => {
      window.removeEventListener('mousemove', update)
      window.removeEventListener('touchmove', update)
    }
  }, [setMouseX, setMouseY])

  const [windowSize, setWindowSize] = useState(getWindowSize())

  useEffect(() => {
    function handleWindowResize() {
      setWindowSize(getWindowSize())
    }

    window.addEventListener('resize', handleWindowResize)

    return () => {
      window.removeEventListener('resize', handleWindowResize)
    }
  }, [])

  function getWindowSize() {
    const { innerWidth, innerHeight } = window
    return { innerWidth, innerHeight }
  }

  useEffect(() => {
    if (loading && !characterExists) {
      characterStringSplitter(
        demoCharacter,
        setCharacter,
        setCharacterExists,
        setLoading,
        setSpecSelected
      )
    }
  }, [loading, character, characterExists, region, server, characterName])

  useEffect(() => {
    if (!Object.values(charLoading).includes(false) && charLoading) {
      setLoading(false)
    }
  }, [charLoading, character])

  useEffect(() => {
    if (accessToken === '') {
      getAccessToken(
        process.env.REACT_APP_BNET_ID,
        process.env.REACT_APP_BNET_SECRET,
        setAccessToken
      )
    }
    if (accessToken !== '' && Object.values(charLoading).includes(false)) {
      if (characterExists) {
        itemStringToObject(
          character.characterData.itemString,
          accessToken,
          setCharLoading,
          setCharacter
        )
      }
    }
  }, [accessToken, loading, characterExists])

  useEffect(() => {
    if (!WCLToken) {
      getWCLAccessToken(
        process.env.REACT_APP_WCL_ClientID,
        process.env.REACT_APP_WCL_ClientSecret,
        setWCLToken
      )
    }
  }, [WCLToken])

  const locationData = {
    mouseX: mouseX,
    mouseY: mouseY,
    innerWidth: windowSize.innerWidth,
    innerHeight: windowSize.innerHeight,
  }

  return (
    <div>
      {!characterExists && !loading && <div>Character does not exist</div>}
      {loading && (
        <div className="Loader">
          <MoonLoader color={'#5118a7'} width={'50%'} height={8} />
        </div>
      )}
      {!loading && characterExists && (
        <div className="Character">
          <CharacterHeader loading={loading} character={character} />
          <div className="CharacterNav">
            <button
              onClick={() => {
                setNavItem({
                  selected: 'Character',
                  charHighlight: 'IsSelected',
                  achHighlight: '',
                })
              }}
              className={`CharacterNav-item ${navItem.charHighlight}`}
            >
              CHARACTER
            </button>
            <button
              onClick={() => {
                setNavItem({
                  selected: 'Achievements',
                  charHighlight: '',
                  achHighlight: 'IsSelected',
                })
              }}
              className={`CharacterNav-item ${navItem.achHighlight}`}
            >
              ACHIEVEMENTS
            </button>
          </div>
          <div className="Divider" />

          {show && <Tooltip locationData={locationData} item={item} />}

          {navItem.selected === 'Character' && (
            <div className="CompletePaperdoll">
              <ItemSections
                loading={loading}
                setCharLoading={setCharLoading}
                setTooltip={setTooltip}
                character={character}
              />
              <SpecializationSection
                character={character}
                specSelected={specSelected}
                setSpecSelected={setSpecSelected}
              />
              <Raids
                Spec={specSelected.talentString}
                characterMisc={character.characterData.miscInfo}
                characterStats={character.characterData.statistics}
              />
              <PvP
                faction={character.characterData.miscInfo.faction}
                PvP={character.characterData.PvP}
                characterStats={character.characterData.statistics}
              />
            </div>
          )}

          {navItem.selected === 'Achievements' && <Achievements characterStats={character.characterData.statistics}/>}
        </div>
      )}
    </div>
  )
}
